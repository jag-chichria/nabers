{
	"name": "00 Populate Staging",
	"properties": {
		"activities": [
			{
				"name": "copyRatings",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "Select distinct\n\trh.RatingHeaderID,\n\tRatingReferenceNumber,\n\trh.PremiseTypeID,\n\tpremiseType.ClassName as PremiseType,\n\trh.PremiseID,\n\tpremise.PremiseName as PremiseName,\n\tAssessorID,\n\trc.email as AssessorEmail,\n\tcustomer.RegisteredName as Customer_Name, \n\tcustomer.TradingName as Customer_TradingName,\n\tcmaddr.[StreetNumber] as [Customer_Mailing_StreetNumber],\n    cmaddr.[StreetName]  as [Customer_Mailing_StreetName],\n    cmaddr.[Suburb] as [Customer_Mailing_Suburb],\n    cmaddr.[Postcode] as [Customer_Mailing_Postcode],\n\tcmst.ClassName as [Customer_Mailing_State],\n\tcustomer.ABN as [Customer_ABN],\n\tcustomer.customerid as [customer_id],\n\tcorg.ClassName as [Customer_Organisation],\n\tcustomer.SAPNumber as Customer_SAP_Number,\n\n\tRatingPeriodFrom,\n\tRatingPeriodTo,\n\tPublicListingFlag,\n\tOfficerID,\n\tRatingStatusID,\n\trs.ClassName as RatingStatus,\n\tLodgedDate,\n\tPaymentStatusID,\n\tps.ClassName as PaymentStatus,\n\tPaidDate,\n\t--Certificate\n\tCertificateValidFrom,\n\tCertificateValidTo,\n\n\tPremisesName as PremiseNameOnCert,\n\tCustomerName as CustomerNameOnCert,\n\n\trh.DeliveryEmail  as Certificate_Customer_Email,\n\n\tLastActionDate, \n\n\tReplaceFlag,\n\tRenewFlag,\n\tPreviousRatingHeaderID,\n\tNewRatingHeaderID,\n\taddr.[StreetNumber],\n    addr.[StreetName],\n    addr.[Suburb],\n    addr.[Postcode],\n\tst.ClassName as [State],\n\t(select  stuff(list,1,1,'')\n\t\tfrom  (( Select ';' + cast(crt.ClassName as varchar(16)) FROM tblRatingType rt \n\t\t\t\t\tINNER JOIN tblClassification crt on crt.ClassificationID = rt.RatingType\n\t\t\t\t\tand rt.RatingHeaderID = rh.RatingHeaderID\n\t\t\t\t\tfor     xml path(''))) as Sub(list)) as RatingTypes\n\n\n\n\t, scs.CinemaTheatres \n\t, scws.ShoppingCentreWaterSummaryID \n\t, scs.FloorConfiguration\n\t, scs.ParkingSpacesMechanical\n\t, scs.ParkingSpacesNatural \n\t, scs.TotalGymGLAR \n\t, scs.FoodCourtSeats \n\t, rad.conflictOfInterestFlag \n\t, rad.InComplianceWithCurrentRules \n\t, (Select top 1 wsrcl.classname from tblRatingType wsr left join tblClassification wsrcl on wsrcl.ClassificationID = wsr.StarRatingWithGreenPowerID and wsr.RatingHeaderID = rh.RatingHeaderID and wsr.RatingType = 57) as WaterStarRatingWRecycle\n\t, (Select top 1 wsrcl.classname from tblRatingType wsr left join tblClassification wsrcl on wsrcl.ClassificationID = wsr.StarRatingWithoutGreenPowerID and wsr.RatingHeaderID = rh.RatingHeaderID and wsr.RatingType = 57) as WaterStarRatingWoRecycle\n\t, (Select top 1 wsrcl.classname from tblRatingType wsr left join tblClassification wsrcl on wsrcl.ClassificationID = wsr.StarRatingWithGreenPowerID and wsr.RatingHeaderID = rh.RatingHeaderID and wsr.RatingType = 56) as EnergyStarRatingWRecycle\n\t, (Select top 1 wsrcl.classname from tblRatingType wsr left join tblClassification wsrcl on wsrcl.ClassificationID = wsr.StarRatingWithoutGreenPowerID and wsr.RatingHeaderID = rh.RatingHeaderID and wsr.RatingType = 56) as EnergyStarRatingWoRecycle\n\t, isnull(sces.TotalElectricityUse * 3.6, 0) + isnull(sces.TotalGasUse, 0) + isnull(sces.TotalLPGUse * 25.7, 0) + isnull(sces.TotalOilUse * 38.6, 0) + isnull(sces.TotalCoalUse * 22.1, 0) as totalEnergyConsumption\n\t, scs.HoursOfService as WeeklyCoreHoursOfService \n\t, sces.TotalElectricityUse as TotalElectricityConsumption\n\t, sces.TotalOilUse as TotalDieselConsumption\n\t, scws.WaterConsumptionWoRW as WaterConsumption\n\t, scws.WaterUsePerSqmWoRW as RecycleNormalisedWaterConsumption\n\t, scws.WaterConsumptionWoRW as TotalWaterConsumption\n\t, scws.RecycledWaterPercent as TotalRecycledWaterPercent\n\t, sces.TotalGasUse as TotalGasConsumption\n\t, (select top 1 Amount from tblFinancialTransaction ft inner join tblRatingPayment rp on ft.RatingPaymentID = rp.RatingPaymentID\n\t\t\tand rp.RatingHeaderID = rh.RatingHeaderId\n\t\t\twhere FeeCategoryID = 244 -- Loedgement\n\t\t\t) as RatingLodgementFees\n\t, sces.PredictedGHGEmissionsPerSqm as PredictedGreenhouseGasIntensity\n\t, scws.PredictedWaterUsePerGLAR as PredictedAverageWaterUse\n\t, scs.TradingDays as NumberOfTradingDays\n\t, scws.PredictedWaterUsePerGLARWoRW as NoRecyclePredictedAverageWaterUse\n\t, sces.GHGEmissionsPerSqmGLARScope12WoGP as NoGreenPower_GHG_IntensityScope_12\n\t, sces.GHGEmissionsPerSqmGLARScope123WoGP as NoGreenPowerGHGIntensityScope123\n\t, sces.GHGEmissionsScope12WoGP as NoGreenPowerGHGEmissionsScope12\n\t, sces.GHGEmissionsScope123WoGP  as NoGreenPowerGHGEmissionsScope123\n\t, sces.GHGEmissionsPerSqmGLARScope123 as GreenhouseGasIntensityScope123\n\t, sces.GHGEmissionsScope123  as GreenhouseGasEmissionsScope123\n\t, sces.EnergyIntensity\n\t, rad.ComplianceExplanation as ExplainWhyNotCompliant \n\t, scs.IsSmallShoppingCentre\n\t, @{pipeline().parameters.pBatchId} as batch_id\n\t\nfrom tblRatingHeader rh\nleft join tblPremise premise on premise.PremiseID = rh.PremiseID\nleft join tblClassification premiseType on premiseType.ClassificationID = rh.PremiseTypeID\nleft join tblClassification rs on rs.ClassificationID = rh.RatingStatusID\nleft join tblClassification ps on ps.ClassificationID = rh.PaymentStatusID\nleft join tblAdministrator ad on ad.AdministratorID = rh.OfficerID\nleft join tblUser aduser on aduser.UserID = ad.UserID\nleft join tblCustomer customer on customer.CustomerID = rh.CustomerID\nleft join tblRatingContractor rc on rc.RatingContractorID = rh.AssessorID\nleft join tblUser rcuser on rcuser.UserID = rc.UserID\nleft join tblAddress addr on addr.AddressId = premise.PremiseAddressId\nleft join tblClassification st on st.ClassificationID = addr.StateId\nleft join tblAddress cmaddr on cmaddr.AddressId = customer.MailingAddressID\nleft join tblClassification cmst on cmst.ClassificationID = cmaddr.StateId\n\nleft join tblShoppingCentreSummary scs on scs.RatingHeaderID = rh.RatingHeaderID\nleft join tblShoppingCentreEnergySummary sces on sces.RatingHeaderID = rh.RatingHeaderID\nleft join tblShoppingCentreWaterSummary scws on scws.RatingHeaderID = rh.RatingHeaderID\n\nleft join tblAssessorDeclaration rad on rad.RatingHeaderID = rh.RatingHeaderID\n\nleft join tblClassification corg on corg.ClassificationID = customer.OrganisationTypeID\n\nWhere rh.PremiseTypeID = 55\nand RatingStatusID in (157,158)\t\t\t\nand rh.RatingHeaderID in (@{pipeline().parameters.pDeltaRatingHeaderIds})\norder by RatingHeaderID",
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink"
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "RatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingReferenceNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "RatingReferenceNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PremiseTypeID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "PremiseTypeID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PremiseType",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "PremiseType",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PremiseID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "PremiseID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PremiseName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "PremiseName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AssessorID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "AssessorID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AssessorEmail",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "AssessorEmail",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Name",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_TradingName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_TradingName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Mailing_StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Mailing_StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Mailing_StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Mailing_StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Mailing_Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Mailing_Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Mailing_Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Mailing_Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Mailing_State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Mailing_State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_ABN",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_ABN",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "customer_id",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "customer_id",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Organisation",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Organisation",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_SAP_Number",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_SAP_Number",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "RatingPeriodFrom",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "RatingPeriodFrom",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingPeriodTo",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "RatingPeriodTo",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PublicListingFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "PublicListingFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "OfficerID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "OfficerID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingStatusID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RatingStatusID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingStatus",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "RatingStatus",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LodgedDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "LodgedDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PaymentStatusID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "PaymentStatusID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PaymentStatus",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "PaymentStatus",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PaidDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "PaidDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CertificateValidFrom",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "CertificateValidFrom",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CertificateValidTo",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "CertificateValidTo",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PremiseNameOnCert",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "PremiseNameOnCert",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CustomerNameOnCert",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "CustomerNameOnCert",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Certificate_Customer_Email",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Certificate_Customer_Email",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LastActionDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "LastActionDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ReplaceFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ReplaceFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RenewFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "RenewFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PreviousRatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "PreviousRatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NewRatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "NewRatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingTypes",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "RatingTypes",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CinemaTheatres",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "CinemaTheatres",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ShoppingCentreWaterSummaryID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ShoppingCentreWaterSummaryID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FloorConfiguration",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "FloorConfiguration",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ParkingSpacesMechanical",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "ParkingSpacesMechanical",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ParkingSpacesNatural",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "ParkingSpacesNatural",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TotalGymGLAR",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "TotalGymGLAR",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FoodCourtSeats",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "FoodCourtSeats",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "conflictOfInterestFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "conflictOfInterestFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "InComplianceWithCurrentRules",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "InComplianceWithCurrentRules",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "WaterStarRatingWRecycle",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "WaterStarRatingWRecycle",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "WaterStarRatingWoRecycle",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "WaterStarRatingWoRecycle",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "EnergyStarRatingWRecycle",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "EnergyStarRatingWRecycle",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "EnergyStarRatingWoRecycle",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "EnergyStarRatingWoRecycle",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "totalEnergyConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "totalEnergyConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "WeeklyCoreHoursOfService",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "WeeklyCoreHoursOfService",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TotalElectricityConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "TotalElectricityConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TotalDieselConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "TotalDieselConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "WaterConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "WaterConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RecycleNormalisedWaterConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "RecycleNormalisedWaterConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TotalWaterConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "TotalWaterConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TotalRecycledWaterPercent",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "TotalRecycledWaterPercent",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TotalGasConsumption",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "TotalGasConsumption",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingLodgementFees",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "RatingLodgementFees",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PredictedGreenhouseGasIntensity",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "PredictedGreenhouseGasIntensity",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PredictedAverageWaterUse",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "PredictedAverageWaterUse",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NumberOfTradingDays",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "NumberOfTradingDays",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NoRecyclePredictedAverageWaterUse",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "NoRecyclePredictedAverageWaterUse",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NoGreenPower_GHG_IntensityScope_12",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "NoGreenPower_GHG_IntensityScope_12",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NoGreenPowerGHGIntensityScope123",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "NoGreenPowerGHGIntensityScope123",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NoGreenPowerGHGEmissionsScope12",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "NoGreenPowerGHGEmissionsScope12",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "NoGreenPowerGHGEmissionsScope123",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "NoGreenPowerGHGEmissionsScope123",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "GreenhouseGasIntensityScope123",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "GreenhouseGasIntensityScope123",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "GreenhouseGasEmissionsScope123",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "GreenhouseGasEmissionsScope123",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "EnergyIntensity",
									"type": "Decimal",
									"physicalType": "decimal"
								},
								"sink": {
									"name": "EnergyIntensity",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ExplainWhyNotCompliant",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ExplainWhyNotCompliant",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "IsSmallShoppingCentre",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "IsSmallShoppingCentre",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "batch_id",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "batch_id",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "db_source_rating_rowversions",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "cn_db_rating_stage",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "copyAssessor",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": {
							"value": "Select \n\tdistinct \n\trh.RatingHeaderID,\n\trcc.companyid,\n\trc.RatingContractorID as AssessorId,\n\trcuser.UserID as UserId,\n\trcuser.FirstName, \n\trcuser.LastName, \n\ttc.ClassName as Title, \n\tmaddr.[StreetNumber] as Mailing_StreetNumber,\n    maddr.[StreetName] as Mailing_StreetName,\n    maddr.[Suburb] as Mailing_Suburb,\n    maddr.[Postcode] as Mailing_Postcode,\n\tmst.ClassName as Mailing_State,\n\n\tbaddr.[StreetNumber] as Billing_StreetNumber,\n    baddr.[StreetName] as Billing_StreetName,\n    baddr.[Suburb] as Billing_Suburb,\n    baddr.[Postcode] as Billing_Postcode,\n\tbst.ClassName as Billing_State,\n\tPhone,\n\tMobile,\n\tEmail,\n\tJoinedDate,\n\tAccreditationDate,\n\tAccreditationExpiryDate,\n\tAccreditationNumber,\n\tEnergyFlag, \n\tWaterFlag, \n\tWasteFlag\n\t, @{pipeline().parameters.pBatchId} as batch_id\n\t, RequireSupervisionSC\n\t, (select  stuff(list,1,1,'')\n\t\tfrom  (( Select ';' + cast(crst.ClassCode as varchar(16)) FROM PVBMSDB4202.nabersdb.dbo.tblRatingContractorAvailability  rca \n\t\t\t\t\tINNER JOIN PVBMSDB4202.nabersdb.dbo.tblClassification crt on crt.ClassificationID = rca.AvailabilityTypeID\n\t\t\t\t\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification crst on crst.ClassificationID = rca.StateId\n\t\t\t\t\tand rca.RatingContractorID = rc.RatingContractorID and crt.ClassificationID = 459\n\t\t\t\t\tfor     xml path(''))) as Sub(list)) as Metropolitan\n\t, (select  stuff(list,1,1,'')\n\t\tfrom  (( Select ';' + cast(crst.ClassCode as varchar(16)) FROM PVBMSDB4202.nabersdb.dbo.tblRatingContractorAvailability  rca \n\t\t\t\t\tINNER JOIN PVBMSDB4202.nabersdb.dbo.tblClassification crt on crt.ClassificationID = rca.AvailabilityTypeID\n\t\t\t\t\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification crst on crst.ClassificationID = rca.StateId\n\t\t\t\t\tand rca.RatingContractorID = rc.RatingContractorID and crt.ClassificationID = 460\n\t\t\t\t\tfor     xml path(''))) as Sub(list)) as Regional\n\t, case when RetailFlag is null then 0 else RetailFlag end as RetailFlag \n\t, case when HospitalFlag is null then 0 else HospitalFlag end as HospitalFlag \n\t, case when HotelFlag is null then 0 else HotelFlag end as HotelFlag \n\t, case when OfficeFlag is null then 0 else OfficeFlag end as OfficeFlag \n\t, case when ApartmentBuildingFlag is null then 0 else ApartmentBuildingFlag end as ApartmentBuildingFlag \n\t\n\t--into AssessorsStage\n\tfrom \n\t\tPVBMSDB4202.nabersdb.dbo.tblRatingHeader rh\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblRatingContractor rc on rc.RatingContractorID = rh.AssessorID\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblUser rcuser on rcuser.UserID = rc.UserID\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification tc on tc.ClassificationID = TitleID\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblAddress maddr on maddr.AddressId = MailingAddressID\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblAddress baddr on baddr.AddressId = BillingAddressID\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification mst on mst.ClassificationID = maddr.StateId\n\t\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification bst on bst.ClassificationID = baddr.StateId\n\t\tinner join PVBMSDB4202.nabersdb.dbo.tblRatingContractorCompany rcc on rc.RatingContractorID = rcc.assessorid\n\t\t\n\tWhere rh.PremiseTypeID = 55 and \n\t(EndEffectiveDate is null or EndEffectiveDate > getdate())\n\tand RatingStatusID in (157,158)\t\t\t\n and rh.RatingHeaderId in (@{pipeline().parameters.pDeltaRatingHeaderIds})\n\torder by RatingHeaderID",
							"type": "Expression"
						},
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink"
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "RatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "companyid",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "companyid",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AssessorId",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "AssessorId",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "UserId",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "UserId",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FirstName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "FirstName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LastName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "LastName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Title",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Title",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Phone",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Phone",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mobile",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mobile",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Email",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Email",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "JoinedDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "JoinedDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AccreditationDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "AccreditationDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AccreditationExpiryDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "AccreditationExpiryDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AccreditationNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "AccreditationNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "EnergyFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "EnergyFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "WaterFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "WaterFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "WasteFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "WasteFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "batch_id",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "batch_id",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RequireSupervisionSC",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "RequireSupervisionSC",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Metropolitan",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Metropolitan",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Regional",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Regional",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RetailFlag",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RetailFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "HospitalFlag",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "HospitalFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "HotelFlag",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "HotelFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "OfficeFlag",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "OfficeFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ApartmentBuildingFlag",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ApartmentBuildingFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "db_source_rating_rowversions",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "db_stage_assessors",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "copyCompanyStage",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": {
							"value": "select \n\tdistinct \n\trh.RatingHeaderID,\n\tc.ABN, c.CompanyName, c.CompanyID, c.CompanyStatusID,\n\tc.CompanyTypeID, c.CompanyURL, c.MailingAddressID, c.Phone, \n\tc.PIInsuranceExpiryDate, c.PLInsuranceExpiryDate, c.RatingParticipationFlag,\n\tc.SAPCustomerNo, c.ShortName, c.SoleTraderFlag,\n\tmaddr.[StreetNumber] as Mailing_StreetNumber,\n    maddr.[StreetName] as Mailing_StreetName,\n    maddr.[Suburb] as Mailing_Suburb,\n    maddr.[Postcode] as Mailing_Postcode,\n\tmst.ClassName as Mailing_State,\n\n\tbaddr.[StreetNumber] as Billing_StreetNumber,\n    baddr.[StreetName] as Billing_StreetName,\n    baddr.[Suburb] as Billing_Suburb,\n    baddr.[Postcode] as Billing_Postcode,\n\tbst.ClassName as Billing_State,\n\t'Assessor' as Type\n\t, @{pipeline().parameters.pBatchId} as batch_id\n--into CompanyStage\nfrom  \n\tPVBMSDB4202.nabersdb.dbo.tblRatingHeader rh\n\tleft join PVBMSDB4202.nabersdb.dbo.tblRatingContractor rc on rc.RatingContractorID = rh.AssessorID\n\tinner join PVBMSDB4202.nabersdb.dbo.tblRatingContractorCompany rcc on rc.RatingContractorID = rcc.assessorid\n\tinner join PVBMSDB4202.nabersdb.dbo.tblCompany c on c.companyid = rcc.companyid\n\tleft join PVBMSDB4202.nabersdb.dbo.tblAddress maddr on maddr.AddressId = c.MailingAddressID\n\tleft join PVBMSDB4202.nabersdb.dbo.tblAddress baddr on baddr.AddressId = c.BillingAddressID\n\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification mst on mst.ClassificationID = maddr.StateId\n\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification bst on bst.ClassificationID = baddr.StateId\nWhere rh.PremiseTypeID = 55 \n\tand (EndEffectiveDate is null or EndEffectiveDate > getdate())\n\tand RatingStatusID in (157,158)\t\t\t--Certified Current/Expired\n\nand rh.RatingHeaderId In (@{pipeline().parameters.pDeltaRatingHeaderIds})\n\norder by RatingHeaderID",
							"type": "Expression"
						},
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink"
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "RatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ABN",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ABN",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CompanyName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "CompanyName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CompanyID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "CompanyID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CompanyStatusID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "CompanyStatusID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CompanyTypeID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "CompanyTypeID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CompanyURL",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "CompanyURL",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "MailingAddressID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "MailingAddressID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Phone",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Phone",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PIInsuranceExpiryDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "PIInsuranceExpiryDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PLInsuranceExpiryDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "PLInsuranceExpiryDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingParticipationFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "RatingParticipationFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "SAPCustomerNo",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "SAPCustomerNo",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ShortName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "ShortName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "SoleTraderFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "SoleTraderFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mailing_State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mailing_State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Billing_State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Billing_State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Type",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Type",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "batch_id",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "batch_id",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "db_source_rating_rowversions",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "db_stage_company",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "copyTechOfficerStage",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": {
							"value": "Select distinct \n\t\trh.RatingHeaderID\n\t\t, a.AdministratorID\n\t\t, u.FirstName \n\t\t, u.LastName  \n\t\t, ag.FullName \n\t\t, a.JobTitle\n\t\t, a.Phone\n\t\t, a.Mobile\n\t\t, a.Fax\n\t\t, a.Email\n\t\t, oc1.ClassName as OtherContactType1\n\t\t, a.OtherContact1\n\t\t, oc2.ClassName as OtherContactType2\n\t\t, a.OtherContact2\n\t\t, a.ProgramManagerFlag\n\t\t, a.AccountManagerFlag\n\t\t, a.SystemAdministratorFlag\n\t\t, a.AssessorCustomerFlag\n\t\t, a.RatingFlag\n\t\t, a.AuditFlag\n\t\t, a.TrainingFlag\n\t\t, a.CAFlag\n\t\t, a.EnquiryFlag\n\t\t, a.PaymentFlag\n\t\t, a.PrintFlag\n\t\t, a.ResourceFlag\n\t\t, a.PublisherFlag\n\t\t, a.JoinedDate\n\t\t, @{pipeline().parameters.pBatchId} as batch_id\n--into TechOfficersStage\nfrom PVBMSDB4202.nabersdb.dbo.tblAdministrator a \n\tinner join PVBMSDB4202.nabersdb.dbo.tblRatingHeader rh on rh.OfficerID = a.AdministratorID\n\tinner join PVBMSDB4202.nabersdb.dbo.tblAgency ag on ag.AgencyID = a.AgencyID\n\tinner join PVBMSDB4202.nabersdb.dbo.tblUser u on u.UserID  = a.UserID\n\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification oc1 on oc1.ClassificationID = a.OtherContactTypeID1\n\tleft join PVBMSDB4202.nabersdb.dbo.tblClassification oc2 on oc2.ClassificationID = a.OtherContactTypeID2\nwhere PremiseTypeID = 55\nand RatingStatusID in (157,158)\t\t\t--Certified Current/Expired\n\nand rh.ratingheaderid in (@{pipeline().parameters.pDeltaRatingHeaderIds})\n\norder by RatingHeaderID",
							"type": "Expression"
						},
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink"
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "RatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AdministratorID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "AdministratorID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FirstName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "FirstName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LastName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "LastName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FullName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "FullName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "JobTitle",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "JobTitle",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Phone",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Phone",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mobile",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mobile",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Fax",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Fax",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "Email",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Email",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "OtherContactType1",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "OtherContactType1",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "OtherContact1",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "OtherContact1",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "OtherContactType2",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "OtherContactType2",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "OtherContact2",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "OtherContact2",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "ProgramManagerFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ProgramManagerFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AccountManagerFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "AccountManagerFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "SystemAdministratorFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "SystemAdministratorFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AssessorCustomerFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "AssessorCustomerFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "RatingFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AuditFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "AuditFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "TrainingFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "TrainingFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CAFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "CAFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "EnquiryFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "EnquiryFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PaymentFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "PaymentFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PrintFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "PrintFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ResourceFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ResourceFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PublisherFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "PublisherFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "JoinedDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "JoinedDate",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "batch_id",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "batch_id",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "db_source_rating_rowversions",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "db_stage_techofficer",
						"type": "DatasetReference"
					}
				]
			},
			{
				"name": "copyCustomerContactStage",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": {
							"value": "Select distinct \n\trh.CustomerID, \n\trcc.RatingHeaderID, \n\tcc.CustomerContactID,\n\tcc.ContactID,\n\tc.Position, \n\trt.ClassName as RoleType,\n\taddr.[StreetNumber] as StreetNumber,\n    addr.[StreetName] as StreetName,\n    addr.[Suburb] as Suburb,\n    addr.[Postcode] as Postcode,\n\tmst.ClassName as [State]\n\n\t, c.phone, c.Mobile, c.fax, \n\nc.Email, c.AccountManagerFlag, c.ManageRatingFlag, c.ViewRatingFlag, c.ManageCAFlag, c.ViewCAFlag, \n\nu.FirstName, u.LastName, tc.ClassName as Title, u.LoginName\n\n, @{pipeline().parameters.pBatchId} as batch_id\n--into CustomerContactStage\nfrom PVBMSDB4202.NABERSDB.dbo.tblRatingHeader rh\ninner join PVBMSDB4202.NABERSDB.dbo.tblCustomerContact cc on cc.CustomerID = rh.CustomerID\ninner join PVBMSDB4202.NABERSDB.dbo.tblContact c on c.ContactId = cc.ContactId\nLEFT join PVBMSDB4202.NABERSDB.dbo.tblRatingCustomerContact rcc on rcc.ratingheaderid = rh.ratingheaderid\n\t\t\tand rcc.CustomerContactID = cc.CustomerContactID\ninner join PVBMSDB4202.NABERSDB.dbo.tblUser u on u.UserID = c.UserID\n\t\tleft join PVBMSDB4202.NABERSDB.dbo.tblClassification tc on tc.ClassificationID = TitleID\n\t\tleft join PVBMSDB4202.NABERSDB.dbo.tblAddress addr on addr.AddressId = c.AddressID\t\t\n\t\tleft join PVBMSDB4202.NABERSDB.dbo.tblClassification mst on mst.ClassificationID = addr.StateId\n\t\tleft join PVBMSDB4202.NABERSDB.dbo.tblClassification rt on rt.ClassificationID = c.RoleTypeID\n\nWhere rh.PremiseTypeID = 55\nand rh.RatingStatusID in (157,158)\t\t\t--Certified Current/Expired\nand rh.RatingHeaderId In (@{pipeline().parameters.pDeltaRatingHeaderIds})\n\n\norder by RatingHeaderID",
							"type": "Expression"
						},
						"queryTimeout": "02:00:00"
					},
					"sink": {
						"type": "AzureSqlSink"
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "CustomerID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "CustomerID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RatingHeaderID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "RatingHeaderID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CustomerContactID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "CustomerContactID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ContactID",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "ContactID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Position",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Position",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "RoleType",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "RoleType",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "StreetNumber",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "StreetNumber",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "StreetName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "StreetName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Suburb",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Suburb",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Postcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Postcode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "State",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "State",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "phone",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "phone",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Mobile",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Mobile",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "fax",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "fax",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Email",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Email",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "AccountManagerFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "AccountManagerFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ManageRatingFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ManageRatingFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ViewRatingFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ViewRatingFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ManageCAFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ManageCAFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ViewCAFlag",
									"type": "Boolean",
									"physicalType": "bit"
								},
								"sink": {
									"name": "ViewCAFlag",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FirstName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "FirstName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LastName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "LastName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Title",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Title",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LoginName",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "LoginName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "batch_id",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "batch_id",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "db_source_rating_rowversions",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "db_stage_customer_contact",
						"type": "DatasetReference"
					}
				]
			}
		],
		"parameters": {
			"pBatchId": {
				"type": "string",
				"defaultValue": "1"
			},
			"pDeltaRatingHeaderIds": {
				"type": "string"
			}
		},
		"variables": {
			"deltaRowHeaderIds": {
				"type": "String"
			},
			"newBatchId": {
				"type": "String"
			}
		},
		"annotations": []
	}
}